<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Sukey" />

<meta name="date" content="2018-10-11" />

<title>Homework 05: Factor and figure management</title>

<script src="Factor_and_figure_management_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="Factor_and_figure_management_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="Factor_and_figure_management_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="Factor_and_figure_management_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="Factor_and_figure_management_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="Factor_and_figure_management_files/navigation-1.1/tabsets.js"></script>
<link href="Factor_and_figure_management_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="Factor_and_figure_management_files/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Homework 05: Factor and figure management</h1>
<h4 class="author"><em>Sukey</em></h4>
<h4 class="date"><em>October 11, 2018</em></h4>

</div>


<div id="part-1-factor-management" class="section level1">
<h1>Part 1: Factor management</h1>
<div id="elaboration-for-the-gapminder-data-set" class="section level2">
<h2>Elaboration for the gapminder data set</h2>
<p><strong>Follwings are my preparation work</strong></p>
<pre class="r"><code>## load all packages
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(plotly))  
suppressPackageStartupMessages(library(gapminder))
suppressPackageStartupMessages(library(knitr))
suppressPackageStartupMessages(library(forcats))
suppressPackageStartupMessages(library(gridExtra))
suppressPackageStartupMessages(library(grid))
suppressPackageStartupMessages(library(gtable))
suppressPackageStartupMessages(library(scales))

## set the table theme 

myt &lt;- ttheme_default( 
         # Use hjust and x to center the text
         # Alternate the row fill colours
                 core = list( fg_params=list( hjust = 0.5 , x = 0.5 ),   # 1: right 0:left 0.5:center
                             bg_params=list( fill=c( &quot;green&quot;, &quot;pink&quot; ) ) ),

         # Change column header to white text and red background
                 colhead = list( fg_params=list( col=&quot;white&quot; ),
                                bg_params=list( fill=&quot;red&quot; ) ) 
         )</code></pre>
<div id="drop-oceania." class="section level3">
<h3>Drop Oceania.</h3>
<p>Filter the Gapminder data to remove observations associated with the continent of Oceania. Additionally, remove unused factor levels. Provide concrete information on the data before and after removing these rows and Oceania; address the number of rows and the levels of the affected factors.</p>
<p><strong>First, let’s check the original structure of gapminder</strong></p>
<pre class="r"><code>## the original structure of gapminder:

### convert the ouput of str() to table
data.frame( variable = names( gapminder ),
           classes = sapply( gapminder, class ),
           factorlevel = sapply( gapminder, nlevels ),
           first_values = sapply( gapminder, function( x ) paste0( head( x ),  collapse = &quot;, &quot;) ),
           row.names = NULL ) %&gt;% 
  kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="left">classes</th>
<th align="right">factorlevel</th>
<th align="left">first_values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">country</td>
<td align="left">factor</td>
<td align="right">142</td>
<td align="left">Afghanistan, Afghanistan, Afghanistan, Afghanistan, Afghanistan, Afghanistan</td>
</tr>
<tr class="even">
<td align="left">continent</td>
<td align="left">factor</td>
<td align="right">5</td>
<td align="left">Asia, Asia, Asia, Asia, Asia, Asia</td>
</tr>
<tr class="odd">
<td align="left">year</td>
<td align="left">integer</td>
<td align="right">0</td>
<td align="left">1952, 1957, 1962, 1967, 1972, 1977</td>
</tr>
<tr class="even">
<td align="left">lifeExp</td>
<td align="left">numeric</td>
<td align="right">0</td>
<td align="left">28.801, 30.332, 31.997, 34.02, 36.088, 38.438</td>
</tr>
<tr class="odd">
<td align="left">pop</td>
<td align="left">integer</td>
<td align="right">0</td>
<td align="left">8425333, 9240934, 10267083, 11537966, 13079460, 14880372</td>
</tr>
<tr class="even">
<td align="left">gdpPercap</td>
<td align="left">numeric</td>
<td align="right">0</td>
<td align="left">779.4453145, 820.8530296, 853.10071, 836.1971382, 739.9811058, 786.11336</td>
</tr>
</tbody>
</table>
<p>As shown in the output above, we can notice that country is a factor with 142 levels and continent is a factor with 5 levels.</p>
<p><strong>Then,let’s check if there is any difference after removing all country in Oceania.</strong></p>
<pre class="r"><code>## remove all rows whose country is Oceania from gapminder
gapRemove &lt;- gapminder %&gt;% 
  filter( continent != &quot;Oceania&quot; ) %&gt;% 
  droplevels() </code></pre>
<pre><code>## Warning: package &#39;bindrcpp&#39; was built under R version 3.5.1</code></pre>
<pre class="r"><code>## show the tables before and after removing Oceania
grid.arrange(top = &quot; Factor count comparison of gapminder and gapRemove&quot;,
             tableGrob(fct_count(gapRemove$continent),
                       theme = myt,
                       rows = NULL),
             tableGrob(fct_count(gapminder$continent),
                       theme = myt,
                       rows = NULL),
                       nrow = 1)</code></pre>
<p><img src="Factor_and_figure_management_files/figure-html/remove%20oceania-1.png" width="768" /></p>
<pre class="r"><code>## check the number of rows of each dataframe                         
nrow(gapminder)</code></pre>
<pre><code>## [1] 1704</code></pre>
<pre class="r"><code>nrow(gapRemove)</code></pre>
<pre><code>## [1] 1680</code></pre>
<p>The left table is the factor count of gapRemove, compared with the right one, we can notice that continent “Oceania” has been removed. The total row of gapminder is 1704 while the total row of gapRemove is 1680, and the difference between the total row number of these two dataframe is 24, which is just the “Oceania” count number in the right table.</p>
</div>
<div id="reorder-the-levels-of-country-or-continent" class="section level3">
<h3>Reorder the levels of country or continent</h3>
<p>Use the forcats package to change the order of the factor levels, based on a principled summary of one of the quantitative variables. Consider experimenting with a summary statistic beyond the most basic choice of the median.</p>
<pre class="r"><code>lifeExp.mean.fig &lt;- gapminder %&gt;%
  ## reorder the continent by the mean value of life expectancy
  mutate( continent = fct_reorder( continent, lifeExp, mean ) ) %&gt;% 
  ## plot gapminder
  ggplot( aes( continent, lifeExp ) )+
  geom_boxplot( aes( fill = continent ) ) +
  ## statistic summary, show the mean value
  stat_summary( fun.y=mean, colour=&quot;darkred&quot;, geom=&quot;point&quot;, size=2,show.legend  = TRUE ) +
  stat_summary( fun.y=mean, colour=&quot;white&quot;, geom=&quot;text&quot;, size = 3, show.legend  = TRUE, 
               vjust=-0.7, aes( label=round( ..y.., digits=1 ) ) ) +
  ggtitle(&quot; Reorder by the mean value of life expectancy &quot;) +
  ## center ggtitle
  theme(plot.title = element_text(hjust = 0.5))

## calculate the mean lifeExp of each continent and sort by the mean value
lifeExp.mean.table &lt;- gapminder %&gt;% 
  group_by( continent ) %&gt;%
  summarize( meanlifeExp = mean( lifeExp ) ) %&gt;% 
  arrange( meanlifeExp ) 

grid.arrange( tableGrob( lifeExp.mean.table,
                         theme = myt,
                         rows = NULL),
             lifeExp.mean.fig,
             nrow = 1)</code></pre>
<p><img src="Factor_and_figure_management_files/figure-html/Reorder%20by%20the%20mean%20value%20of%20life%20expectancy-1.png" width="960" /></p>
<p>As shown in the table and graph above, gapminder is reorder according to the mean of lifeExp of each continent. We can notice that the mean life expectancy of Oceania and Europe are pretty similar and higher than mean life expectancy of other continents while Africa has the lowest life expectancy mean which is only 48.9 years old.</p>
<pre class="r"><code>gdp.mean.fig &lt;- gapminder %&gt;%
  ## reorder the continent by the mean value of gdpPercap
  mutate( continent = fct_reorder( continent, gdpPercap, mean ) ) %&gt;% 
  ## plot gapminder
  ggplot( aes( continent, gdpPercap ) )+
  geom_boxplot( aes( fill = continent ) ) +
  ## statistic summary, show the mean value
  stat_summary( fun.y=mean, colour=&quot;darkred&quot;, geom=&quot;point&quot;, size=2,show.legend  = TRUE ) +
  stat_summary( fun.y=mean, colour=&quot;red&quot;, geom=&quot;text&quot;, size = 4, show.legend  = TRUE, 
               vjust=-0.7, aes( label=round( ..y.., digits=1 ) ) ) +
  ggtitle(&quot; Reorder by the mean value of gdpPercap &quot;) +
  ## center ggtitle
  theme(plot.title = element_text(hjust = 0.5))

## calculate the mean gdpPercap of each continent and sort by the mean value
gdp.mean.table &lt;- gapminder %&gt;% 
  group_by( continent ) %&gt;%
  summarize( meangdpPercap = mean( gdpPercap ) ) %&gt;% 
  arrange( meangdpPercap ) 

grid.arrange( tableGrob( gdp.mean.table,
                         theme = myt,
                         rows = NULL),
             gdp.mean.fig,
             nrow = 1)</code></pre>
<p><img src="Factor_and_figure_management_files/figure-html/Reorder%20by%20the%20mean%20value%20of%20gdp-capita-1.png" width="960" /> As shown in the table and graph above, gapminder is reorder according to the mean of gdp/capita of each continent. We can notice that the gdp/capita mean of Oceania is much higher than the gdp/capita mean of other continents and Africa has the lowest gdp/capita mean which is only around 2193.</p>
</div>
</div>
</div>
<div id="part-2-file-io" class="section level1">
<h1>Part 2: File I/O</h1>
<p>Experiment with one or more of write_csv()/read_csv() (and/or TSV friends), saveRDS()/readRDS(), dput()/dget(). Create something new, probably by filtering or grouped-summarization of Singer or Gapminder. I highly recommend you fiddle with the factor levels, i.e. make them non-alphabetical (see previous section). Explore whether this survives the round trip of writing to file then reading back in.</p>
<div id="write_csvread_csv" class="section level2">
<h2>write_csv()/read_csv()</h2>
<p><strong>I am interested data in Oceania since although it has the smallest number of countries, mean life expectancy and gdp/capita of it is the highest. I would like to save the data of Oceania locally but I also want to reorder the data in terms of year instead of the initial of each country</strong></p>
<pre class="r"><code>Oceania &lt;- gapminder %&gt;%
  filter( continent == &quot;Oceania&quot;) %&gt;% 
  arrange( year ) %&gt;% 
  droplevels()
  
grid.arrange( top = &quot; Top 10 rows of data in Oceania&quot;,
              tableGrob( head( Oceania, 10 ),
                         theme = myt,
                         rows = NULL))</code></pre>
<p><img src="Factor_and_figure_management_files/figure-html/extract%20all%20data%20in%20Oceania-1.png" width="960" /> <strong>Save all data in Oceania with a new order locally</strong></p>
<pre class="r"><code>write_csv(Oceania, &quot;Oceania.csv&quot;)</code></pre>
<p><strong>load Oceania.csv file</strong></p>
<pre class="r"><code>Oceania.read &lt;- read_csv(&quot;Oceania.csv&quot;)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   country = col_character(),
##   continent = col_character(),
##   year = col_integer(),
##   lifeExp = col_double(),
##   pop = col_integer(),
##   gdpPercap = col_double()
## )</code></pre>
<p><strong>let’s check if there is any difference between Oceania and Oceania.read</strong></p>
<pre class="r"><code>## check the structure of each dataframe
data.frame( variable = names( Oceania ),
           classes = sapply( Oceania, class ),
           factorlevel = sapply( Oceania, nlevels ),
           first_values = sapply( Oceania, function( x ) paste0( head( x ),  collapse = &quot;, &quot;) ),
           row.names = NULL ) %&gt;% 
  kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="left">classes</th>
<th align="right">factorlevel</th>
<th align="left">first_values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">country</td>
<td align="left">factor</td>
<td align="right">2</td>
<td align="left">Australia, New Zealand, Australia, New Zealand, Australia, New Zealand</td>
</tr>
<tr class="even">
<td align="left">continent</td>
<td align="left">factor</td>
<td align="right">1</td>
<td align="left">Oceania, Oceania, Oceania, Oceania, Oceania, Oceania</td>
</tr>
<tr class="odd">
<td align="left">year</td>
<td align="left">integer</td>
<td align="right">0</td>
<td align="left">1952, 1952, 1957, 1957, 1962, 1962</td>
</tr>
<tr class="even">
<td align="left">lifeExp</td>
<td align="left">numeric</td>
<td align="right">0</td>
<td align="left">69.12, 69.39, 70.33, 70.26, 70.93, 71.24</td>
</tr>
<tr class="odd">
<td align="left">pop</td>
<td align="left">integer</td>
<td align="right">0</td>
<td align="left">8691212, 1994794, 9712569, 2229407, 10794968, 2488550</td>
</tr>
<tr class="even">
<td align="left">gdpPercap</td>
<td align="left">numeric</td>
<td align="right">0</td>
<td align="left">10039.59564, 10556.57566, 10949.64959, 12247.39532, 12217.22686, 13175.678</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame( variable = names( Oceania.read ),
           classes = sapply( Oceania.read, class ),
           factorlevel = sapply( Oceania.read, nlevels ),
           first_values = sapply( Oceania.read, function( x ) paste0( head( x ),  collapse = &quot;, &quot;) ),
           row.names = NULL ) %&gt;% 
  kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="left">classes</th>
<th align="right">factorlevel</th>
<th align="left">first_values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">country</td>
<td align="left">character</td>
<td align="right">0</td>
<td align="left">Australia, New Zealand, Australia, New Zealand, Australia, New Zealand</td>
</tr>
<tr class="even">
<td align="left">continent</td>
<td align="left">character</td>
<td align="right">0</td>
<td align="left">Oceania, Oceania, Oceania, Oceania, Oceania, Oceania</td>
</tr>
<tr class="odd">
<td align="left">year</td>
<td align="left">integer</td>
<td align="right">0</td>
<td align="left">1952, 1952, 1957, 1957, 1962, 1962</td>
</tr>
<tr class="even">
<td align="left">lifeExp</td>
<td align="left">numeric</td>
<td align="right">0</td>
<td align="left">69.12, 69.39, 70.33, 70.26, 70.93, 71.24</td>
</tr>
<tr class="odd">
<td align="left">pop</td>
<td align="left">integer</td>
<td align="right">0</td>
<td align="left">8691212, 1994794, 9712569, 2229407, 10794968, 2488550</td>
</tr>
<tr class="even">
<td align="left">gdpPercap</td>
<td align="left">numeric</td>
<td align="right">0</td>
<td align="left">10039.59564, 10556.57566, 10949.64959, 12247.39532, 12217.22686, 13175.678</td>
</tr>
</tbody>
</table>
<p>As shown in the two tables above, the conutry and continent have been converted to character.<strong>A better way is to use wirte.csv() and read.csv()</strong></p>
</div>
<div id="write.csvread.csv" class="section level2">
<h2>write.csv()/read.csv()</h2>
<pre class="r"><code>write.csv( Oceania, file = &quot;Oceanianew.csv&quot; , row.names = FALSE)
Oceanianew.csv.read &lt;- read.csv( &quot;Oceanianew.csv&quot; )

## check the structure of each dataframe
data.frame( variable = names( Oceania ),
           classes = sapply( Oceania, class ),
           factorlevel = sapply( Oceania, nlevels ),
           first_values = sapply( Oceania, function( x ) paste0( head( x ),  collapse = &quot;, &quot;) ),
           row.names = NULL ) %&gt;% 
  kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="left">classes</th>
<th align="right">factorlevel</th>
<th align="left">first_values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">country</td>
<td align="left">factor</td>
<td align="right">2</td>
<td align="left">Australia, New Zealand, Australia, New Zealand, Australia, New Zealand</td>
</tr>
<tr class="even">
<td align="left">continent</td>
<td align="left">factor</td>
<td align="right">1</td>
<td align="left">Oceania, Oceania, Oceania, Oceania, Oceania, Oceania</td>
</tr>
<tr class="odd">
<td align="left">year</td>
<td align="left">integer</td>
<td align="right">0</td>
<td align="left">1952, 1952, 1957, 1957, 1962, 1962</td>
</tr>
<tr class="even">
<td align="left">lifeExp</td>
<td align="left">numeric</td>
<td align="right">0</td>
<td align="left">69.12, 69.39, 70.33, 70.26, 70.93, 71.24</td>
</tr>
<tr class="odd">
<td align="left">pop</td>
<td align="left">integer</td>
<td align="right">0</td>
<td align="left">8691212, 1994794, 9712569, 2229407, 10794968, 2488550</td>
</tr>
<tr class="even">
<td align="left">gdpPercap</td>
<td align="left">numeric</td>
<td align="right">0</td>
<td align="left">10039.59564, 10556.57566, 10949.64959, 12247.39532, 12217.22686, 13175.678</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame( variable = names( Oceanianew.csv.read ),
           classes = sapply( Oceanianew.csv.read, class ),
           factorlevel = sapply( Oceanianew.csv.read, nlevels ),
           first_values = sapply( Oceanianew.csv.read, function( x ) paste0( head( x ),  collapse = &quot;, &quot;) ),
           row.names = NULL ) %&gt;% 
  kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="left">classes</th>
<th align="right">factorlevel</th>
<th align="left">first_values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">country</td>
<td align="left">factor</td>
<td align="right">2</td>
<td align="left">Australia, New Zealand, Australia, New Zealand, Australia, New Zealand</td>
</tr>
<tr class="even">
<td align="left">continent</td>
<td align="left">factor</td>
<td align="right">1</td>
<td align="left">Oceania, Oceania, Oceania, Oceania, Oceania, Oceania</td>
</tr>
<tr class="odd">
<td align="left">year</td>
<td align="left">integer</td>
<td align="right">0</td>
<td align="left">1952, 1952, 1957, 1957, 1962, 1962</td>
</tr>
<tr class="even">
<td align="left">lifeExp</td>
<td align="left">numeric</td>
<td align="right">0</td>
<td align="left">69.12, 69.39, 70.33, 70.26, 70.93, 71.24</td>
</tr>
<tr class="odd">
<td align="left">pop</td>
<td align="left">integer</td>
<td align="right">0</td>
<td align="left">8691212, 1994794, 9712569, 2229407, 10794968, 2488550</td>
</tr>
<tr class="even">
<td align="left">gdpPercap</td>
<td align="left">numeric</td>
<td align="right">0</td>
<td align="left">10039.59564, 10556.57566, 10949.64959, 12247.39532, 12217.22686, 13175.678</td>
</tr>
<tr class="odd">
<td align="left">Now the stru</td>
<td align="left">cture of O</td>
<td align="right">ceania and Oce</td>
<td align="left">anianew are same.</td>
</tr>
</tbody>
</table>
</div>
<div id="saverdsreadrds" class="section level2">
<h2>saveRDS()/readRDS()</h2>
<pre class="r"><code>saveRDS( Oceania,&quot;Oceania.rds&quot; )
Oceania.rds.read &lt;- readRDS( &quot;Oceania.rds&quot; )

## check the structure of each dataframe
data.frame( variable = names( Oceania ),
           classes = sapply( Oceania, class ),
           factorlevel = sapply( Oceania, nlevels ),
           first_values = sapply( Oceania, function( x ) paste0( head( x ),  collapse = &quot;, &quot;) ),
           row.names = NULL ) %&gt;% 
  kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="left">classes</th>
<th align="right">factorlevel</th>
<th align="left">first_values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">country</td>
<td align="left">factor</td>
<td align="right">2</td>
<td align="left">Australia, New Zealand, Australia, New Zealand, Australia, New Zealand</td>
</tr>
<tr class="even">
<td align="left">continent</td>
<td align="left">factor</td>
<td align="right">1</td>
<td align="left">Oceania, Oceania, Oceania, Oceania, Oceania, Oceania</td>
</tr>
<tr class="odd">
<td align="left">year</td>
<td align="left">integer</td>
<td align="right">0</td>
<td align="left">1952, 1952, 1957, 1957, 1962, 1962</td>
</tr>
<tr class="even">
<td align="left">lifeExp</td>
<td align="left">numeric</td>
<td align="right">0</td>
<td align="left">69.12, 69.39, 70.33, 70.26, 70.93, 71.24</td>
</tr>
<tr class="odd">
<td align="left">pop</td>
<td align="left">integer</td>
<td align="right">0</td>
<td align="left">8691212, 1994794, 9712569, 2229407, 10794968, 2488550</td>
</tr>
<tr class="even">
<td align="left">gdpPercap</td>
<td align="left">numeric</td>
<td align="right">0</td>
<td align="left">10039.59564, 10556.57566, 10949.64959, 12247.39532, 12217.22686, 13175.678</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame( variable = names( Oceania.rds.read ),
           classes = sapply( Oceania.rds.read, class ),
           factorlevel = sapply( Oceania.rds.read, nlevels ),
           first_values = sapply( Oceania.rds.read, function( x ) paste0( head( x ),  collapse = &quot;, &quot;) ),
           row.names = NULL ) %&gt;% 
  kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="left">classes</th>
<th align="right">factorlevel</th>
<th align="left">first_values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">country</td>
<td align="left">factor</td>
<td align="right">2</td>
<td align="left">Australia, New Zealand, Australia, New Zealand, Australia, New Zealand</td>
</tr>
<tr class="even">
<td align="left">continent</td>
<td align="left">factor</td>
<td align="right">1</td>
<td align="left">Oceania, Oceania, Oceania, Oceania, Oceania, Oceania</td>
</tr>
<tr class="odd">
<td align="left">year</td>
<td align="left">integer</td>
<td align="right">0</td>
<td align="left">1952, 1952, 1957, 1957, 1962, 1962</td>
</tr>
<tr class="even">
<td align="left">lifeExp</td>
<td align="left">numeric</td>
<td align="right">0</td>
<td align="left">69.12, 69.39, 70.33, 70.26, 70.93, 71.24</td>
</tr>
<tr class="odd">
<td align="left">pop</td>
<td align="left">integer</td>
<td align="right">0</td>
<td align="left">8691212, 1994794, 9712569, 2229407, 10794968, 2488550</td>
</tr>
<tr class="even">
<td align="left">gdpPercap</td>
<td align="left">numeric</td>
<td align="right">0</td>
<td align="left">10039.59564, 10556.57566, 10949.64959, 12247.39532, 12217.22686, 13175.678</td>
</tr>
<tr class="odd">
<td align="left">Nothing chan</td>
<td align="left">ge because</td>
<td align="right">the class of</td>
<td align="left">data is preserved.</td>
</tr>
</tbody>
</table>
</div>
<div id="dputdget" class="section level2">
<h2>dput()/dget()</h2>
<pre class="r"><code>dput( Oceania,&quot;Oceania.txt&quot; )
Oceania.txt.read &lt;- dget( &quot;Oceania.txt&quot; )

## check the structure of each dataframe
data.frame( variable = names( Oceania ),
           classes = sapply( Oceania, class ),
           factorlevel = sapply( Oceania, nlevels ),
           first_values = sapply( Oceania, function( x ) paste0( head( x ),  collapse = &quot;, &quot;) ),
           row.names = NULL ) %&gt;% 
  kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="left">classes</th>
<th align="right">factorlevel</th>
<th align="left">first_values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">country</td>
<td align="left">factor</td>
<td align="right">2</td>
<td align="left">Australia, New Zealand, Australia, New Zealand, Australia, New Zealand</td>
</tr>
<tr class="even">
<td align="left">continent</td>
<td align="left">factor</td>
<td align="right">1</td>
<td align="left">Oceania, Oceania, Oceania, Oceania, Oceania, Oceania</td>
</tr>
<tr class="odd">
<td align="left">year</td>
<td align="left">integer</td>
<td align="right">0</td>
<td align="left">1952, 1952, 1957, 1957, 1962, 1962</td>
</tr>
<tr class="even">
<td align="left">lifeExp</td>
<td align="left">numeric</td>
<td align="right">0</td>
<td align="left">69.12, 69.39, 70.33, 70.26, 70.93, 71.24</td>
</tr>
<tr class="odd">
<td align="left">pop</td>
<td align="left">integer</td>
<td align="right">0</td>
<td align="left">8691212, 1994794, 9712569, 2229407, 10794968, 2488550</td>
</tr>
<tr class="even">
<td align="left">gdpPercap</td>
<td align="left">numeric</td>
<td align="right">0</td>
<td align="left">10039.59564, 10556.57566, 10949.64959, 12247.39532, 12217.22686, 13175.678</td>
</tr>
</tbody>
</table>
<pre class="r"><code>data.frame( variable = names( Oceania.txt.read ),
           classes = sapply( Oceania.txt.read, class ),
           factorlevel = sapply( Oceania.txt.read, nlevels ),
           first_values = sapply( Oceania.txt.read, function( x ) paste0( head( x ),  collapse = &quot;, &quot;) ),
           row.names = NULL ) %&gt;% 
  kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="left">classes</th>
<th align="right">factorlevel</th>
<th align="left">first_values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">country</td>
<td align="left">factor</td>
<td align="right">2</td>
<td align="left">Australia, New Zealand, Australia, New Zealand, Australia, New Zealand</td>
</tr>
<tr class="even">
<td align="left">continent</td>
<td align="left">factor</td>
<td align="right">1</td>
<td align="left">Oceania, Oceania, Oceania, Oceania, Oceania, Oceania</td>
</tr>
<tr class="odd">
<td align="left">year</td>
<td align="left">integer</td>
<td align="right">0</td>
<td align="left">1952, 1952, 1957, 1957, 1962, 1962</td>
</tr>
<tr class="even">
<td align="left">lifeExp</td>
<td align="left">numeric</td>
<td align="right">0</td>
<td align="left">69.12, 69.39, 70.33, 70.26, 70.93, 71.24</td>
</tr>
<tr class="odd">
<td align="left">pop</td>
<td align="left">integer</td>
<td align="right">0</td>
<td align="left">8691212, 1994794, 9712569, 2229407, 10794968, 2488550</td>
</tr>
<tr class="even">
<td align="left">gdpPercap</td>
<td align="left">numeric</td>
<td align="right">0</td>
<td align="left">10039.59564, 10556.57566, 10949.64959, 12247.39532, 12217.22686, 13175.678</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="part-3-visualization-design" class="section level1">
<h1>Part 3: Visualization design</h1>
<div id="orignial-plot-in-my-past-assignment" class="section level2">
<h2>orignial plot in my past assignment</h2>
<p>This is the task 2 in assignment 3 : Look at the spread of GDP per capita within the continents.</p>
<pre class="r"><code>range_captia &lt;- gapminder %&gt;%
  group_by( continent ) %&gt;% 
  summarize( min_gdp = min( gdpPercap ), max_gdp = max( gdpPercap ),
            mean_gdp = mean( gdpPercap ), md_gdp = median( gdpPercap ),
            sd_gdp = sd( gdpPercap )) %&gt;%  # summarize the basic info of gdp in each continent
  mutate( gdp_range = paste( min_gdp, max_gdp, sep = &quot; ~ &quot;)) %&gt;% # separate minimum and maximum value by ~
  select( continent, gdp_range, mean_gdp, md_gdp, sd_gdp)


spreadplt &lt;- ggplot( gapminder, aes( continent, gdpPercap )) +
  geom_boxplot( aes( fill = continent ))+
  labs( x = &quot;continent&quot;, y = &quot;gdp/capita&quot;, 
              title = &quot;spread of GDP per capita within the continents&quot;) +
  theme(plot.title = element_text(size=22))

rangeplt &lt;- range_captia %&gt;%
  ggplot() +
  geom_line( aes( x = continent, y = mean_gdp, color = &quot;mean&quot;,group = 1 ))+
  geom_line( aes( x = continent,y = md_gdp,color = &quot;median&quot;,group = 1 )) +
  geom_line( aes( x = continent,y = sd_gdp,color = &quot;standard deviation&quot;,group = 1 ))+
  labs(x = &quot;continent&quot;, y = &quot;gdp/capita&quot;, 
              title = &quot;spread of GDP per capita within the continents&quot;) +
  theme(plot.title = element_text(size=22))
  
grid.arrange(tableGrob(range_captia),
             spreadplt,
             rangeplt,
             nrow = 2)</code></pre>
<p><img src="Factor_and_figure_management_files/figure-html/past%20plot-1.png" width="1440" /></p>
</div>
<div id="modified-graph" class="section level2">
<h2>Modified graph</h2>
<p>I would like to improve the graph above.</p>
<pre class="r"><code>spreadplt.new &lt;- gapminder %&gt;%
  mutate( continent = fct_reorder( continent, gdpPercap, mean ) ) %&gt;% 
  ggplot( aes( x = continent, y = gdpPercap ) )+
  geom_boxplot( aes( colour = continent ),
                outlier.alpha = 0.1 )+
  ## add mean value on the graph
  stat_summary( fun.y=mean, colour=&quot;darkred&quot;, geom=&quot;point&quot;, size=2,show.legend  = TRUE ) +
  stat_summary( fun.y=mean, colour=&quot;red&quot;, geom=&quot;text&quot;, size = 4, show.legend  = TRUE, 
               vjust=-0.7, aes( label=round( ..y.., digits=1 ) ) ) +
  ## add &quot;$&quot;
  scale_y_continuous(labels=dollar_format()) +
  theme_bw()+
  
  
  labs( x = &quot;continent&quot;, y = &quot;gdp/capita&quot;) +
  theme(
         axis.text.x = element_text( size = 12 ),
         axis.text.y = element_text( size = 12 ),
         axis.title = element_text( size = 14),
         legend.text = element_text( size = 14 ),
         legend.title = element_text( size = 15),
         plot.background = element_rect( fill = &quot;white&quot;, colour = &quot;grey50&quot; ),
         panel.border = element_rect(linetype = &quot;dashed&quot;, fill = NA)
         )


new_colors &lt;- c(&quot;mean&quot; = &quot;black&quot;, &quot;median&quot; = &quot;blue&quot;,&quot;standard deviation&quot; = &quot;red&quot; )
rangeplt.new &lt;- range_captia %&gt;%
  ggplot() +
  geom_line( aes( x = continent, y = mean_gdp, color = &quot;mean&quot;,group = 1 ))+
  geom_line( aes( x = continent,y = md_gdp,color = &quot;median&quot;,group = 1 )) +
  
  geom_line( aes( x = continent,y = sd_gdp,color = &quot;standard deviation&quot;,group = 1 ))+
  scale_y_sqrt(labels=dollar_format())+
  
  labs(x = &quot;continent&quot;, y = &quot;gdp/capita&quot;) +
  
 
  
  scale_colour_manual( &quot;Statistic summary:&quot;,  
                       values = new_colors,
                       breaks = c(&quot;mean&quot;, &quot;median&quot;,&quot;standard deviation&quot; ), # The original values 
                       labels = c(&quot; The Mean&quot;, &quot;The Median&quot;,&quot;The Stdev&quot;)   # What you want to call them 
  )+
  theme_bw()+
   theme(
         axis.text.x = element_text( size = 10 ),
         axis.text.y = element_text( size = 10 ),
         axis.title = element_text( size = 14),
         legend.text = element_text( size = 14 ),
         legend.title = element_text( size = 15),
         plot.background = element_rect( fill = &quot;white&quot;, colour = &quot;black&quot; ),
         panel.border = element_rect(linetype = &quot;dashed&quot;, fill = NA)
         )

  
graph &lt;- grid.arrange( top=textGrob( &quot;Spread of GDP per capita within the continents&quot;,
                            gp=gpar( fontsize = 22,font = 8 ) ),
              
              tableGrob( range_captia,
                         theme = myt,
                         rows = NULL),
             spreadplt.new,
             rangeplt.new,
             nrow = 2)</code></pre>
<p><img src="Factor_and_figure_management_files/figure-html/remake%20plot-1.png" width="1440" /></p>
<p><strong>Changes I made</strong><br />
* for table:<br />
+ remove the rownames + change the table theme</p>
<ul>
<li>for boxplot:
<ul>
<li>write the mean gdp/capita on each continent</li>
<li>change the theme
<ul>
<li>label size</li>
<li>legend size</li>
<li>backgroud</li>
<li>border</li>
<li>add “$” on y label</li>
</ul></li>
</ul></li>
<li>for line:
<ul>
<li>change the theme
<ul>
<li>label size</li>
<li>legend size</li>
<li>legend name and lengend item label size</li>
<li>backgroud</li>
<li>border</li>
<li>add “$” on y label</li>
</ul></li>
</ul></li>
<li>add a title of these three graphs and change its font and size</li>
</ul>
</div>
<div id="plotly" class="section level2">
<h2>plotly</h2>
<pre class="r"><code>#ggplotly(spreadplt.new)</code></pre>
<p>ggplotly() can:</p>
<ul>
<li>zoom in and zoom out</li>
<li>show the statistics summary of boxplot</li>
<li>can download the plot as png</li>
<li><a href="https://plot.ly/r/">more details could be found here</a></li>
</ul>
<p><strong>the output of ggplotly() is only suitable for html file, so I commented <code>ggplotly(spreadplt.new)</code> here</strong></p>
</div>
</div>
<div id="part-4-writing-figures-to-file" class="section level1">
<h1>Part 4: Writing figures to file</h1>
<div id="write-figure" class="section level2">
<h2>write figure</h2>
<pre class="r"><code>ggsave(&quot;graph.png&quot;, graph, width=50, height=30, units = &quot;cm&quot;)</code></pre>
</div>
<div id="load-figure" class="section level2">
<h2>load figure</h2>
<div class="figure">
<img src="https://github.com/STAT545-UBC-students/hw05-Sukeysun/blob/master/graph.png" />

</div>
</div>
</div>
<div id="but-i-want-to-do-more" class="section level1">
<h1>But I want to do more!</h1>
<p>I would like to create an excerpt of the Gapminder data and add a “language” column to the new data.</p>
<pre class="r"><code>country_language &lt;- 
  data.frame(
  country = c(&quot;Afghanistan&quot;,&quot;Italy&quot;, &quot;Australia&quot;,&quot;Germany&quot;, &quot;Japan&quot;,&quot;Spain&quot;, &quot;Mexico&quot;,&quot;Portugal&quot;),
  language = c(&quot;Dari Persian&quot;,&quot;Italian&quot;,&quot;German&quot;,&quot;German&quot;,&quot;Japanese&quot;,&quot;Spanish&quot;,&quot;Spanish&quot;,&quot;Portuguese&quot;)
) 

sub_gapminder &lt;- gapminder %&gt;%
  filter( country%in% c(&quot;Afghanistan&quot;,&quot;Italy&quot;, &quot;Australia&quot;,&quot;Germany&quot;, &quot;Japan&quot;,&quot;Spain&quot;, &quot;Mexico&quot;,&quot;Portugal&quot;) ) %&gt;% 
  droplevels()

# subgapminder.add.language &lt;- gapminder %&gt;%
#   left_join ( country_language, by = &quot;country&quot; ) %&gt;% 
#   filter( language!= &quot;NA&quot;) %&gt;% 
#   droplevels()

subgapminder.add.language &lt;- left_join( sub_gapminder, country_language)</code></pre>
<pre><code>## Joining, by = &quot;country&quot;</code></pre>
<pre class="r"><code>## check the structure of subgapminder.add.language
data.frame( variable = names( subgapminder.add.language ),
           classes = sapply( subgapminder.add.language, class ),
           factorlevel = sapply( subgapminder.add.language, nlevels ),
           #first_values = sapply( subgapminder.add.language, function( x ) paste0( head( x ),  collapse = &quot;, &quot;) ),
           row.names = NULL ) %&gt;% 
  kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="left">classes</th>
<th align="right">factorlevel</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">country</td>
<td align="left">factor</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">continent</td>
<td align="left">factor</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">year</td>
<td align="left">integer</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">lifeExp</td>
<td align="left">numeric</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">pop</td>
<td align="left">integer</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">gdpPercap</td>
<td align="left">numeric</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">language</td>
<td align="left">factor</td>
<td align="right">6</td>
</tr>
</tbody>
</table>
<div id="fct_anon" class="section level2">
<h2>fct_anon</h2>
<p>I would like to replaces factor levels of “language” with arbitary numeric identifiers.</p>
<pre class="r"><code>original_fct &lt;- fct_count( subgapminder.add.language$language )
new_fct &lt;- subgapminder.add.language$language %&gt;% 
  fct_anon( &quot;x&quot; ) %&gt;%  ## add &quot;x&quot; before the numeric identifiers
  fct_count()

grid.arrange(
             tableGrob(original_fct,
                       theme = myt,
                       rows = NULL),
             tableGrob(new_fct,
                       theme = myt,
                       rows = NULL),
                       nrow = 1)</code></pre>
<p><img src="Factor_and_figure_management_files/figure-html/Replaces%20factor%20levels%20with%20arbitary%20numeric%20identifiers-1.png" width="960" /> Now the languages are replaced by x1,x2…</p>
</div>
<div id="fct_collapse" class="section level2">
<h2>fct_collapse</h2>
<p>This function can collapse factor levels into manually defined groups. Since countries are from different continents, I would like to define a new factors group according to the continents.</p>
<pre class="r"><code>## first, look at what languages are in each continent.
language_continent &lt;- subgapminder.add.language %&gt;% 
  group_by( continent ) %&gt;% 
  select ( continent, language) %&gt;% 
  unique()

language2 &lt;- fct_collapse( subgapminder.add.language$language,
  language.only.in.Asia = c( &quot;Dari Persian&quot;, &quot;Japanese&quot; ),
  used.in.more.continents = c( &quot;German&quot;, &quot;Spanish&quot;),
  language.only.inEurope = c( &quot;Italian&quot;, &quot;Portuguese&quot;)
) %&gt;% 
  fct_count()

grid.arrange(
             tableGrob(language_continent,
                       theme = myt,
                       rows = NULL),
             tableGrob(original_fct,
                       theme = myt,
                       rows = NULL),
             tableGrob(language2,
                       theme = myt,
                       rows = NULL),
                       nrow = 1)</code></pre>
<p><img src="Factor_and_figure_management_files/figure-html/define%20new%20froup-1.png" width="960" /> The first table shows the languages used in continents, the second table shows the original output and the third one shows the output after collapsing factor levels into manually defined groups.</p>
</div>
<div id="fct_infreq" class="section level2">
<h2>fct_infreq</h2>
<p>This function can reorder factors levels by frequency. I would like to reorder the factors levels of subgapminder.add.language$language</p>
<pre class="r"><code>reorder_fct &lt;- fct_infreq( subgapminder.add.language$language ) %&gt;% 
  fct_count()
grid.arrange(
             tableGrob(original_fct,
                       theme = myt,
                       rows = NULL),
             tableGrob(reorder_fct,
                       theme = myt,
                       rows = NULL),
                       nrow = 1)</code></pre>
<p><img src="Factor_and_figure_management_files/figure-html/reorder%20the%20factors%20levels%20according%20to%20frequency-1.png" width="960" /></p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
